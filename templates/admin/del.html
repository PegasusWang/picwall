<%inherit file="/base/waterfall.html"/>

<%block name="title">
    <title>图片墙</title>
</%block>

<%block name="waterfall">
    <div id="container"></div>


    <script type="text/x-handlebars-template" id="waterfall-tpl">
    <%text>
    {{#result}}
        <div class="item">
            <img src="{{image}}" width="{{width}}" height="{{height}}" />
            <input type="button" value="删除图片" onclick="deleteImg(this)"/>
        </div>
    {{/result}}
    </%text>
    </script>


    <script src="${static_url("js/libs/jquery/jquery.js")}"></script>
    <script src="${static_url("js/libs/handlebars/handlebars.js")}"></script>
    <script src="${static_url("js/libs/jquery.easing.js")}"></script>
    <script src="${static_url("js/waterfall.js")}"></script>

    <script>
    function getCookie(name) {
        var r = document.cookie.match("\\b" + name + "=([^;]*)\\b");
        return r ? r[1] : undefined;
    }
    function deleteImg(obj) {
        var node = obj.parentNode;
        var imgNode = node.getElementsByTagName('img')
        var imgSrc = imgNode[0].getAttribute('src');
    }

    jQuery.postJSON = function(url, args, callback) {
        args._xsrf = getCookie("_xsrf");
        $.ajax({url: url, data: $.param(args), dataType: "text", type: "POST",
            success: function(response) {
                callback(eval("(" + response + ")"));
            }});
    };
    //1.$.ajax带json数据的异步请求
    $.ajax({
        url: 'productManager_reverseUpdate',// 跳转到 action
        data: {
            'class_name': ${class_name},
            'src': imgSrc
        },
        type: 'post',
        cache: false,
        dataType: 'json',
        success:function(data) {
            if(data.msg =="true" ){
                // view("修改成功！");
                alert("修改成功！");
                //window.location.reload();
            } else {
                view(data.msg);
            }
         },
         error : function() {
              // view("异常！");
              alert("异常！");
         }
    });

    </script>

    <script>
    $('#container').waterfall({
        itemCls: 'item',
        colWidth: 400,
        maxCol: 4,
        gutterWidth: 15,
        gutterHeight: 15,
        checkImagesLoaded: false,
        isAnimated: true,
        isFadeIn: true,
        dataType: 'text',
        animationOptions: {
        },
        path: function(page) {
        return '${class_name}/data.json?page=' + page;
        }
    });
    </script>
</%block>

